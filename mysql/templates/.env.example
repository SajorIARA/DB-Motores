# ====================================================================================
# VARIABLES DE ENTORNO PARA MYSQL + MONITOREO
# ====================================================================================
# Copia este archivo a .env y personaliza los valores
# Comando: cp templates/.env.example .env
# ====================================================================================

# ====================================================================================
# MYSQL - CREDENCIALES
# ====================================================================================
# ⚠️ IMPORTANTE: Usa contraseñas fuertes en producción (16+ caracteres)

# Contraseña del usuario root (REQUERIDA)
MYSQL_ROOT_PASSWORD=SecureRootPassword123!

# Usuario de aplicación (opcional pero recomendado)
MYSQL_USER=app_user
MYSQL_PASSWORD=SecureAppPassword123!

# Base de datos inicial (opcional)
MYSQL_DATABASE=mydatabase

# ====================================================================================
# MYSQL - PUERTOS
# ====================================================================================

# Puerto de MySQL (default: 3306)
MYSQL_PORT=3306

# ====================================================================================
# MYSQL - CONFIGURACIÓN DE RENDIMIENTO
# ====================================================================================

# Buffer Pool Size (memoria principal de InnoDB)
# Desarrollo: 128M - 512M
# Producción: 2G - 8G (70-80% de RAM)
# Analytics: 1G - 4G
MYSQL_INNODB_BUFFER_POOL_SIZE=2G

# Instancias del buffer pool (recomendado: 8 para > 1GB)
MYSQL_INNODB_BUFFER_POOL_INSTANCES=8

# Conexiones máximas
# Desarrollo: 50
# Producción: 500
# Testing: 20
# Analytics: 100
MYSQL_MAX_CONNECTIONS=500

# Tamaño de log files de InnoDB
# Desarrollo: 48M
# Producción: 512M
# Testing: 24M
# Analytics: 256M
MYSQL_INNODB_LOG_FILE_SIZE=512M

# Buffer de log de InnoDB
MYSQL_INNODB_LOG_BUFFER_SIZE=64M

# Flush method (O_DIRECT para producción con SSD)
MYSQL_INNODB_FLUSH_METHOD=O_DIRECT

# I/O capacity (ajustar según tipo de disco)
# HDD: 200
# SSD: 2000-4000
# NVMe: 5000+
MYSQL_INNODB_IO_CAPACITY=2000
MYSQL_INNODB_IO_CAPACITY_MAX=4000

# Threads de I/O
MYSQL_INNODB_READ_IO_THREADS=8
MYSQL_INNODB_WRITE_IO_THREADS=8

# ====================================================================================
# MYSQL - CONFIGURACIÓN DE QUERIES
# ====================================================================================

# Query cache (deshabilitado en MySQL 8.0 por defecto, mejor performance)
MYSQL_QUERY_CACHE_SIZE=0
MYSQL_QUERY_CACHE_TYPE=0

# Buffers de sorts y reads
MYSQL_SORT_BUFFER_SIZE=4M
MYSQL_READ_BUFFER_SIZE=2M
MYSQL_READ_RND_BUFFER_SIZE=4M
MYSQL_JOIN_BUFFER_SIZE=4M

# Tablas temporales
MYSQL_TMP_TABLE_SIZE=64M
MYSQL_MAX_HEAP_TABLE_SIZE=64M

# Thread cache
MYSQL_THREAD_CACHE_SIZE=100

# Table cache
MYSQL_TABLE_OPEN_CACHE=4000
MYSQL_TABLE_DEFINITION_CACHE=2000

# ====================================================================================
# MYSQL - LOGGING
# ====================================================================================

# General log (1 = activado, 0 = desactivado)
# ⚠️ Solo en desarrollo, degrada performance
MYSQL_GENERAL_LOG=0

# Slow query log
MYSQL_SLOW_QUERY_LOG=1
MYSQL_LONG_QUERY_TIME=5

# Log error verbosity (1 = minimal, 2 = normal, 3 = verbose)
MYSQL_LOG_ERROR_VERBOSITY=2

# ====================================================================================
# MYSQL - TIMEOUTS (Analytics/Data Warehouse)
# ====================================================================================

# Timeout máximo de ejecución (milisegundos, 0 = sin límite)
MYSQL_MAX_EXECUTION_TIME=0

# Interactive timeout (segundos)
MYSQL_INTERACTIVE_TIMEOUT=28800

# Wait timeout (segundos)
MYSQL_WAIT_TIMEOUT=28800

# ====================================================================================
# GRAFANA - CREDENCIALES
# ====================================================================================

# Usuario admin de Grafana
GF_ADMIN_USER=admin

# Contraseña admin de Grafana
# ⚠️ Cambiar en producción
GF_ADMIN_PASSWORD=SecureGrafanaPass123!

# URL base de Grafana
GF_SERVER_ROOT_URL=http://localhost:3000

# Puerto de Grafana
GRAFANA_PORT=3000

# ====================================================================================
# PROMETHEUS
# ====================================================================================

# Puerto de Prometheus
PROMETHEUS_PORT=9090

# Retención de datos (días)
PROMETHEUS_RETENTION_DAYS=30d

# ====================================================================================
# MYSQLD EXPORTER
# ====================================================================================

# Puerto del exporter
MYSQLD_EXPORTER_PORT=9104

# ====================================================================================
# NOTAS Y RECOMENDACIONES
# ====================================================================================
#
# 1. SEGURIDAD:
#    - Usa contraseñas fuertes (16+ caracteres, mezcla de mayúsculas, minúsculas, números, símbolos)
#    - No commitees este archivo .env en Git (está en .gitignore)
#    - En producción, considera usar Docker secrets
#
# 2. BUFFER POOL:
#    - Regla general: 70-80% de RAM total del servidor
#    - Ejemplo con 8GB RAM: MYSQL_INNODB_BUFFER_POOL_SIZE=6G
#    - Monitorea con: SHOW STATUS LIKE 'Innodb_buffer_pool%';
#
# 3. CONEXIONES:
#    - Cada conexión consume ~1-2MB de RAM
#    - max_connections muy alto puede agotar memoria
#    - Monitorea con: SHOW STATUS LIKE 'Threads_connected';
#
# 4. I/O CAPACITY:
#    - HDD tradicional: 200
#    - SSD SATA: 2000-4000
#    - NVMe: 5000-10000
#    - Verifica con: iostat -x 1
#
# 5. QUERY CACHE:
#    - En MySQL 8.0+ está deprecado y deshabilitado
#    - Mejor performance sin query cache
#
# 6. LOGGING:
#    - GENERAL_LOG degrada mucho el performance, solo en desarrollo
#    - SLOW_QUERY_LOG es útil en producción para optimización
#
# 7. TIMEOUTS:
#    - Valores bajos previenen queries huérfanos
#    - Valores altos necesarios para analytics/reporting
#
# ====================================================================================
