# ====================================================================================
# VARIABLES DE ENTORNO - PRODUCTION
# ====================================================================================
# Este es un archivo de ejemplo para configurar el ambiente de producción
# Copia este archivo como .env y cambia los valores por los tuyos
# NUNCA comitear el archivo .env con contraseñas reales
# ====================================================================================

# ====================================================================================
# POSTGRESQL - Credenciales y Base de Datos
# ====================================================================================
POSTGRES_USER=prod_user
POSTGRES_PASSWORD=CHANGE_THIS_PASSWORD_123
POSTGRES_DB=production_db
POSTGRES_PORT=5432

# ====================================================================================
# POSTGRESQL - Configuración de Performance
# ====================================================================================
# Ajustar según tu servidor (4GB = shared_buffers de 1GB recomendado)
POSTGRES_SHARED_BUFFERS=2GB
POSTGRES_EFFECTIVE_CACHE_SIZE=6GB
POSTGRES_WORK_MEM=64MB
POSTGRES_MAINTENANCE_WORK_MEM=512MB
POSTGRES_MAX_CONNECTIONS=200

# ====================================================================================
# POSTGRESQL - WAL y Checkpoints
# ====================================================================================
POSTGRES_CHECKPOINT_TIMEOUT=15min
POSTGRES_MAX_WAL_SIZE=4GB
POSTGRES_MIN_WAL_SIZE=1GB
POSTGRES_WAL_BUFFERS=16MB

# ====================================================================================
# POSTGRESQL - Optimización para SSD
# ====================================================================================
POSTGRES_RANDOM_PAGE_COST=1.1
POSTGRES_EFFECTIVE_IO_CONCURRENCY=200

# ====================================================================================
# POSTGRESQL - Autovacuum
# ====================================================================================
POSTGRES_AUTOVACUUM_MAX_WORKERS=4
POSTGRES_AUTOVACUUM_NAPTIME=10s

# ====================================================================================
# POSTGRESQL - Query Planner
# ====================================================================================
POSTGRES_DEFAULT_STATISTICS_TARGET=100

# ====================================================================================
# POSTGRESQL - Logging
# ====================================================================================
# none = sin logging, ddl = solo DDL, mod = DDL+DML, all = todas
POSTGRES_LOG_STATEMENT=none
# Milisegundos (-1 = desactivado, 0 = todas, 1000 = queries > 1 segundo)
POSTGRES_LOG_MIN_DURATION_STATEMENT=1000
POSTGRES_LOG_LINE_PREFIX=%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h

# ====================================================================================
# POSTGRESQL - Seguridad
# ====================================================================================
POSTGRES_HOST_AUTH_METHOD=scram-sha-256
POSTGRES_INITDB_ARGS=--auth-host=scram-sha-256 --encoding=UTF8 --locale=C

# ====================================================================================
# POSTGRESQL EXPORTER
# ====================================================================================
EXPORTER_PORT=9187

# ====================================================================================
# PROMETHEUS
# ====================================================================================
PROMETHEUS_PORT=9090
PROMETHEUS_RETENTION_TIME=30d
PROMETHEUS_RETENTION_SIZE=50GB

# ====================================================================================
# GRAFANA - Credenciales
# ====================================================================================
GF_ADMIN_USER=admin
GF_ADMIN_PASSWORD=CHANGE_THIS_GRAFANA_PASSWORD

# ====================================================================================
# GRAFANA - Servidor
# ====================================================================================
GF_SERVER_DOMAIN=localhost
GF_SERVER_ROOT_URL=http://localhost:3000
GF_LOG_LEVEL=info

# ====================================================================================
# DOCKER - Límites de Recursos
# ====================================================================================
POSTGRES_CPU_LIMIT=4.0
POSTGRES_MEMORY_LIMIT=8G
POSTGRES_CPU_RESERVATION=2.0
POSTGRES_MEMORY_RESERVATION=4G

# ====================================================================================
# NOTAS IMPORTANTES
# ====================================================================================
#
# 1. SEGURIDAD:
#    - Cambia TODAS las contraseñas por defecto
#    - NO uses contraseñas simples en producción
#    - Considera usar Docker Secrets para producción real
#
# 2. PERFORMANCE:
#    - shared_buffers: 25% de RAM del servidor (máx 8GB)
#    - effective_cache_size: 50-75% de RAM del servidor
#    - work_mem: Ajustar según tus queries (mucho = OOM)
#    - max_connections: No más de lo necesario (cada conexión consume RAM)
#
# 3. ALMACENAMIENTO:
#    - Usa SSD/NVMe para mejor performance
#    - Ajusta random_page_cost según tu disco (SSD=1.1, HDD=4.0)
#    - Configura backups automáticos
#
# 4. MONITOREO:
#    - Retención de Prometheus: Ajustar según espacio disponible
#    - Logs de queries lentas: Ajustar min_duration según necesidad
#
# 5. PRODUCCIÓN REAL:
#    - Configura SSL/TLS
#    - Restringe acceso en pg_hba.conf
#    - Implementa backups automáticos
#    - Configura alertas en Prometheus
#    - Usa un balanceador de carga si es necesario
#
# ====================================================================================
