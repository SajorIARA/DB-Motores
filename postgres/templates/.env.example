# ====================================================================================
# EJEMPLO DE ARCHIVO .env PARA PLANTILLAS
# ====================================================================================
# Copia este archivo como ".env" y personaliza los valores según tu entorno
# Uso: docker-compose -f templates/[plantilla].yml --env-file .env up -d
# ====================================================================================

# ====================================================================================
# POSTGRESQL - CREDENCIALES
# ====================================================================================
# ⚠️ OBLIGATORIO: Definir en producción
POSTGRES_USER=myuser
POSTGRES_PASSWORD=SecurePassword123!
POSTGRES_DB=mydatabase

# Puerto de PostgreSQL (default: 5432)
POSTGRES_PORT=5432

# ====================================================================================
# POSTGRESQL - CONFIGURACIÓN DE MEMORIA
# ====================================================================================
# Ajustar según RAM disponible (ver README.md para recomendaciones)

# shared_buffers: 25% de RAM disponible (máx 40%)
POSTGRES_SHARED_BUFFERS=1GB

# effective_cache_size: 50-75% de RAM total del servidor
POSTGRES_EFFECTIVE_CACHE_SIZE=4GB

# work_mem: Para queries individuales (4MB-128MB)
POSTGRES_WORK_MEM=16MB

# maintenance_work_mem: Para VACUUM, CREATE INDEX (64MB-1GB)
POSTGRES_MAINTENANCE_WORK_MEM=256MB

# ====================================================================================
# POSTGRESQL - CONEXIONES Y PROCESOS
# ====================================================================================
# Número máximo de conexiones simultáneas
POSTGRES_MAX_CONNECTIONS=100

# Workers para paralelización de queries
POSTGRES_MAX_WORKER_PROCESSES=8
POSTGRES_MAX_PARALLEL_WORKERS_PER_GATHER=4
POSTGRES_MAX_PARALLEL_WORKERS=8

# Workers para autovacuum
POSTGRES_AUTOVACUUM_MAX_WORKERS=3

# ====================================================================================
# POSTGRESQL - WAL Y CHECKPOINTS
# ====================================================================================
# Timeout de checkpoints (5min-30min)
POSTGRES_CHECKPOINT_TIMEOUT=10min

# Tamaño máximo de WAL (512MB-8GB)
POSTGRES_MAX_WAL_SIZE=2GB

# Tamaño mínimo de WAL
POSTGRES_MIN_WAL_SIZE=512MB

# WAL buffers (-1 = auto, o 16MB-64MB)
POSTGRES_WAL_BUFFERS=-1

# ====================================================================================
# POSTGRESQL - OPTIMIZACIÓN I/O
# ====================================================================================
# random_page_cost: 4.0 para HDD, 1.1-1.5 para SSD
POSTGRES_RANDOM_PAGE_COST=1.1

# effective_io_concurrency: 1 para HDD, 200 para SSD
POSTGRES_EFFECTIVE_IO_CONCURRENCY=200

# ====================================================================================
# POSTGRESQL - QUERY PLANNER
# ====================================================================================
# Statistics target (default: 100, alto: 500-1000 para analytics)
POSTGRES_DEFAULT_STATISTICS_TARGET=100

# ====================================================================================
# POSTGRESQL - LOGGING
# ====================================================================================
# Log statement: none, ddl, mod, all
POSTGRES_LOG_STATEMENT=none

# Log queries más lentas que X milisegundos (-1 = off)
POSTGRES_LOG_MIN_DURATION_STATEMENT=1000

# Prefijo de logs
POSTGRES_LOG_LINE_PREFIX=%t [%p]: [%l-1] user=%u,db=%d,app=%a 

# ====================================================================================
# POSTGRESQL - RECURSOS (Docker Deploy)
# ====================================================================================
# Límites de CPU
POSTGRES_CPU_LIMIT=4.0
POSTGRES_CPU_RESERVATION=2.0

# Límites de RAM
POSTGRES_MEMORY_LIMIT=8G
POSTGRES_MEMORY_RESERVATION=4G

# ====================================================================================
# POSTGRES EXPORTER
# ====================================================================================
# Puerto del exporter (default: 9187)
EXPORTER_PORT=9187

# Bases de datos a incluir (regex)
PG_EXPORTER_INCLUDE_DATABASES=.*

# ====================================================================================
# PROMETHEUS
# ====================================================================================
# Puerto de Prometheus (default: 9090)
PROMETHEUS_PORT=9090

# Retención de datos (7d, 15d, 30d, 90d)
PROMETHEUS_RETENTION_TIME=15d

# Tamaño máximo de almacenamiento
PROMETHEUS_RETENTION_SIZE=10GB

# Rutas de datos (para volúmenes bind mount)
PROMETHEUS_DATA_PATH=./data/prometheus

# ====================================================================================
# GRAFANA
# ====================================================================================
# Puerto de Grafana (default: 3000)
GRAFANA_PORT=3000

# Credenciales admin (⚠️ CAMBIAR EN PRODUCCIÓN)
GF_ADMIN_USER=admin
GF_ADMIN_PASSWORD=ChangeMe123!

# Dominio del servidor
GF_SERVER_DOMAIN=localhost
GF_SERVER_ROOT_URL=http://localhost:3000

# Log level: debug, info, warn, error
GF_LOG_LEVEL=info

# ====================================================================================
# GRAFANA - SMTP (OPCIONAL - Para alertas por email)
# ====================================================================================
# GF_SMTP_ENABLED=true
# GF_SMTP_HOST=smtp.gmail.com:587
# GF_SMTP_USER=your-email@gmail.com
# GF_SMTP_PASSWORD=your-app-password
# GF_SMTP_FROM_ADDRESS=your-email@gmail.com
# GF_SMTP_FROM_NAME=Grafana PostgreSQL Alerts

# ====================================================================================
# REDES
# ====================================================================================
# Subnet personalizada (default: 172.20.0.0/16)
NETWORK_SUBNET=172.20.0.0/16

# ====================================================================================
# RUTAS DE DATOS (Para volúmenes bind mount en producción)
# ====================================================================================
# Ruta de datos de PostgreSQL
POSTGRES_DATA_PATH=./data/postgres

# ====================================================================================
# NOTAS IMPORTANTES
# ====================================================================================
# 
# 1. SEGURIDAD:
#    - Nunca commitear este archivo .env al repositorio
#    - Agregar .env al .gitignore
#    - Usar Docker secrets en producción real
# 
# 2. CÁLCULO DE RAM:
#    - shared_buffers = 25% RAM disponible para PostgreSQL
#    - effective_cache_size = 50-75% RAM total del servidor
#    - work_mem = Total RAM / max_connections / 4
# 
# 3. VALIDAR CONFIGURACIÓN:
#    docker-compose -f templates/[plantilla].yml config
# 
# 4. CALCULAR PARÁMETROS:
#    https://pgtune.leopard.in.ua/
# 
# ====================================================================================
